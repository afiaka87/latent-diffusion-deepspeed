# Configuration for Cog ⚙️
# Reference: https://github.com/replicate/cog/blob/main/docs/yaml.md

image: "r8.im/afiaka87/ldm-artistic"
build:
  # set to true if your model requires a GPU
  gpu: true

  # a list of ubuntu apt packages to install
  system_packages:
    - libopenmpi-dev
    - "libglib2.0-0"
    - wget

  # python version in the form '3.8' or '3.8.12'
  python_version: "3.8"

  # a list of packages in the format <package-name>==<version>
  python_packages:
    - "Cython==0.29.28"
    - "absl-py==1.0.0"
    - "aiohttp==3.8.1"
    - "aiosignal==1.2.0"
    - "antlr4-python3-runtime==4.8"
    - "asttokens==2.0.5"
    - "async-timeout==4.0.2"
    - "attrs==21.4.0"
    - "autopep8==1.6.0"
    - "axial-positional-embedding==0.2.1"
    - "backcall==0.2.0"
    - "blessings==1.7"
    - "blobfile==1.2.8"
    - "braceexpand==0.1.7"
    - "cachetools==5.0.0"
    - "certifi==2021.10.8"
    - "charset-normalizer==2.0.12"
    - "click==8.1.2"
    - "cycler==0.11.0"
    - "DALL-E==0.1"
    - "dalle-pytorch==1.5.1"
    - "debugpy==1.6.0"
    - "decorator==5.1.1"
    - "docker-pycreds==0.4.0"
    - "einops==0.4.1"
    - "entrypoints==0.4"
    - "executing==0.8.3"
    - "filelock==3.6.0"
    - "fonttools==4.31.2"
    - "frozenlist==1.3.0"
    - "fsspec==2022.3.0"
    - "ftfy==6.1.1"
    - "flask==2.1.1"
    - "gitdb==4.0.9"
    - "GitPython==3.1.27"
    - "google-auth==2.6.3"
    - "google-auth-oauthlib==0.4.6"
    - "gpustat==0.6.0"
    - "grpcio==1.44.0"
    - "hjson==3.0.2"
    - "huggingface-hub==0.5.1"
    - "idna==3.3"
    - "importlib-metadata==4.11.3"
    - "iniconfig==1.1.1"
    - "ipykernel==6.12.1"
    - "ipython==8.2.0"
    - "jedi==0.18.1"
    - "joblib==1.1.0"
    - "jupyter-client==7.2.2"
    - "jupyter-core==4.9.2"
    - "kiwisolver==1.4.2"
    - "Markdown==3.3.6"
    - "matplotlib==3.5.1"
    - "matplotlib-inline==0.1.3"
    - "mmh3==3.0.0"
    - "mpi4py==3.1.3"
    - "multidict==6.0.2"
    - "mypy==0.942"
    - "mypy-extensions==0.4.3"
    - "nest-asyncio==1.5.5"
    - "ninja==1.10.2.3"
    - "numpy==1.22.3"
    - "nvidia-ml-py3==7.352.0"
    - "oauthlib==3.2.0"
    - "omegaconf==2.1.1"
    - "packaging==21.3"
    - "pandas==1.4.2"
    - "parso==0.8.3"
    - "pathtools==0.1.2"
    - "pexpect==4.8.0"
    - "pickleshare==0.7.5"
    - "Pillow==9.1.0"
    - "pluggy==1.0.0"
    - "promise==2.3"
    - "prompt-toolkit==3.0.29"
    - "protobuf==3.20.0"
    - "psutil==5.9.0"
    - "ptyprocess==0.7.0"
    - "pure-eval==0.2.2"
    - "py==1.11.0"
    - "py-cpuinfo==8.0.0"
    - "pyasn1==0.4.8"
    - "pyasn1-modules==0.2.8"
    - "pycocoevalcap==1.2"
    - "pycocotools==2.0.4"
    - "pycodestyle==2.8.0"
    - "pycryptodomex==3.14.1"
    - "pyDeprecate==0.3.2"
    - "Pygments==2.11.2"
    - "pyparsing==3.0.7"
    - "pytest==7.1.1"
    - "python-dateutil==2.8.2"
    - "pytorch-lightning==1.6.0"
    - "pytz==2022.1"
    - "PyYAML==6.0"
    - "pyzmq==22.3.0"
    - "regex==2022.3.15"
    - "requests==2.27.1"
    - "requests-oauthlib==1.3.1"
    - "rotary-embedding-torch==0.1.5"
    - "rsa==4.8"
    - "sacremoses==0.0.49"
    - "sentry-sdk==1.5.8"
    - "setproctitle==1.2.2"
    - "shortuuid==1.0.8"
    - "six==1.16.0"
    - "smmap==5.0.0"
    - "stack-data==0.2.0"
    - "tensorboard==2.8.0"
    - "tensorboard-data-server==0.6.1"
    - "tensorboard-plugin-wit==1.8.1"
    - "timm==0.5.4"
    - "tokenizers==0.11.6"
    - "toml==0.10.2"
    - "tomli==2.0.1"
    - "torch==1.10.1"
    - "torchmetrics==0.7.3"
    - "torchvision==0.11.2"
    - "tornado==6.1"
    - "tqdm==4.64.0"
    - "traitlets==5.1.1"
    - "transformers==4.18.0"
    - "typing_extensions==4.1.1"
    - "urllib3==1.26.9"
    - "wandb==0.12.14"
    - "wcwidth==0.2.5"
    - "webdataset==0.2.4"
    - "Werkzeug==2.1.1"
    - "xmltodict==0.12.0"
    - "yarl==1.7.2"
    - "youtokentome==1.0.6"
    - "zipp==3.8.0"
  
  # commands run after the environment is setup
  run:
    - pip3 install -e 'git+https://github.com/Jack000/glid-3-xl.git@9fe15fe771950daef94eb78b22d805b01eceb15a#egg=guided_diffusion'
    - pip3 install -e 'git+https://github.com/CompVis/latent-diffusion.git@8381e5e557a4d8cc1e878f84f6938930e0eb51b4#egg=latent_diffusion'
    - pip3 install -e 'git+https://github.com/CompVis/taming-transformers.git@24268930bf1dce879235a7fddd0b2355b84d7ea6#egg=taming-transformers'
    - wget --output-document "bert.ckpt" --continue 'https://dall-3.com/models/glid-3-xl/bert.pt'

# predict.py defines how predictions are run on your model
predict: "predict.py:Predictor"
